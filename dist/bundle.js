(()=>{"use strict";const e={openPopup(e,t){e.classList.remove(t)},closePopup(e,t){e.classList.add(t)},isEscapeKey:e=>27===e.keyCode,exitOnEscape(e,t,n){27===e.keyCode&&this.closePopup(t,n)},handlePopupClick(e,t,n){e.target===t&&this.closePopup(t,n)},clearInputs(e){if(e)for(let t of e)t.value="","text"===t.type?t.type:t.type="password"},changeType(e){e.forEach((e=>{"password"===e.type?e.type="text":"text"===e.type&&(e.type="password")}))},resetPasswordType(e){e.forEach((e=>{e.type="password"}))}};function t(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}function n(e,n){const a=t("token");return fetch(e,{method:"POST",headers:{"Content-type":"application/json; charset=utf-8",Authorization:`Bearer ${a}`},body:JSON.stringify(n)})}function a(e,n){const a=t("token");return fetch(e,{method:"PUT",headers:{"Content-type":"application/json; charset=utf-8",Authorization:`Bearer ${a}`},body:JSON.stringify(n)})}function o(e){const n=t("token");return fetch(e,{method:"GET",headers:{Authorization:`Bearer ${n}`}})}function s(e){const n=t("token");return fetch(e,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})}function r(){const e=document.getElementById("thead"),t=Array.from(e.querySelectorAll("th")),n=document.getElementById("sort"),a=document.querySelector(".table__sortDropdown"),o=document.getElementById("firstNameSort"),s=document.getElementById("lastnameSort"),r=document.getElementById("ageSort"),c=document.getElementById("citySort"),l=document.getElementById("phonenumberSort"),d=document.getElementById("emailSort"),i=document.getElementById("companynameSort");function u(e,t=!0){const n=document.getElementById("table"),a=document.getElementById("tbody"),o=Array.from(a.querySelectorAll("tr")),s=t?1:-1,r=o.sort(((t,n)=>t.querySelector(`td:nth-child(${e})`).textContent.trim()>n.querySelector(`td:nth-child(${e})`).textContent.trim()?1*s:-1*s));for(;a.firstChild;)a.removeChild(a.firstChild);a.append(...r),n.querySelectorAll("th").forEach((e=>{e.classList.remove("th-sort-asc","th-sort-desc")})),n.querySelector(`th:nth-child(${e})`).classList.toggle("th-sort-asc",t),n.querySelector(`th:nth-child(${e})`).classList.toggle("th-sort-desc",!t)}function m(e,t=!0){const n=document.getElementById("table"),a=document.getElementById("tbody"),o=Array.from(a.querySelectorAll("tr")),s=t?1:-1,r=o.sort(((t,n)=>Number(t.querySelector(`td:nth-child(${e})`).textContent.trim())>Number(n.querySelector(`td:nth-child(${e})`).textContent.trim())?1*s:-1*s));for(;a.firstChild;)a.removeChild(a.firstChild);a.append(...r),n.querySelectorAll("th").forEach((e=>{e.classList.remove("th-sort-asc","th-sort-desc")})),n.querySelector(`th:nth-child(${e})`).classList.toggle("th-sort-asc",t),n.querySelector(`th:nth-child(${e})`).classList.toggle("th-sort-desc",!t)}a.addEventListener("click",(e=>{e.preventDefault();const t=e.target;n.textContent=t.textContent,n.dataset.translate=t.dataset.translate})),u(1,!t[0].classList.contains("th-sort-asc")),o.addEventListener("click",(()=>{u(1,!t[0].classList.contains("th-sort-asc"))})),s.addEventListener("click",(()=>{u(2,!t[1].classList.contains("th-sort-asc"))})),r.addEventListener("click",(()=>{m(3,!t[2].classList.contains("th-sort-asc"))})),c.addEventListener("click",(()=>{u(4,!t[3].classList.contains("th-sort-asc"))})),l.addEventListener("click",(()=>{m(5,!t[4].classList.contains("th-sort-asc"))})),d.addEventListener("click",(()=>{u(6,!t[5].classList.contains("th-sort-asc"))})),i.addEventListener("click",(()=>{u(7,!t[6].classList.contains("th-sort-asc"))}))}function c(){const e=document.getElementById("firstnameInput"),t=document.getElementById("lastnameInput"),n=document.getElementById("ageInput"),a=document.getElementById("cityInput"),o=document.getElementById("phonenumberInput"),s=document.getElementById("emailInput"),r=document.getElementById("companynameInput"),c=document.getElementById("update"),l=document.getElementById("create");l.disabled=!1,c.disabled=!0;const d=document.getElementById("table"),i=document.querySelectorAll(".tbody__tr");let u=null;const m="selected";d.addEventListener("click",(function(d){const h=d.target.closest("tr");h&&i.forEach((d=>{d===h?d.classList.contains(m)?(d.classList.remove(m),u=null,l.disabled=!1,c.disabled=!0,function(e){const{firstName:t,lastName:n,age:a,city:o,phoneNumber:s,email:r,companyName:c}=e;t.value="",n.value="",a.value="",o.value="",c.value="",r.value="",s.value=""}({firstName:e,lastName:t,age:n,city:a,phoneNumber:o,email:s,companyName:r})):(u=d,d.classList.add(m)):d.classList.remove(m)}))})),d.addEventListener("dblclick",(function(d){l.disabled=!0,c.disabled=!1;const i=d.target.closest("tr");if(i){const c=i.querySelector(".td-firstName"),l=i.querySelector(".td-lastName"),d=i.querySelector(".td-age"),u=i.querySelector(".td-city"),m=i.querySelector(".td-phoneNumber"),h=i.querySelector(".td-email"),p=i.querySelector(".td-companyName");e.value=c.textContent,t.value=l.textContent,n.value=d.textContent,a.value=u.textContent,o.value=m.textContent,s.value=h.textContent,r.value=p.textContent}}))}function l(e){const t=document.querySelector("#tbody");tbody.innerHTML="";for(let n=0;n<e.length;n++){const a=document.createElement("tr");a.classList.add("tbody__tr"),a.setAttribute("data-index",e[n].id),a.innerHTML=`\n        <td class="tr__td td-firstName">${e[n].fname}</td>\n        <td class="tr__td td-lastName">${e[n].lname}</td>\n        <td class="tr__td td-age">${e[n].age}</td>\n        <td class="tr__td td-city">${e[n].city}</td>\n        <td class="tr__td td-phoneNumber">${e[n].phoneNumber}</td>\n        <td class="tr__td td-email">${e[n].email}</td>\n        <td class="tr__td td-companyName">${e[n].companyName}</td>\n        <td class="tr__button"><button class="panel__control-delete panel-control-style delete-person" data-index="${e[n].id}">&#128465;</button></td>\n        `,t.append(a)}}class d{static NAME_PATTERN=/^([A-ZА-Я]{1,20})$/i;static EMAIL_PATTERN=/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;static PHONE_PATTERN=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;static REG_AUTH_PATTERN=/^([A-Z0-9!#$%&'*+/=?^_`{|}~-]{5,20})$/i;static CITY_PATTERN=/^([A-ZА-Я]{1}[a-zа-я\s0-9-]{0,19})$/;static validateStr(e,t){return"string"==typeof e&&t.test(e)}static validateNumber(e,t){return"number"==typeof e&&t(e)}}const i={validateName(e){const t=e.value;d.NAME_PATTERN.test(t)?e.classList.remove("has-error"):(e.classList.add("has-error"),e.value="")},validateCity(e){const t=e.value,n=document.querySelector(".input-error-city");d.CITY_PATTERN.test(t)?(e.classList.remove("has-error"),n.classList.add("hide")):(e.classList.add("has-error"),e.value="",n.classList.remove("hide"))},validateEmail(e){const t=e.value,n=document.querySelector(".input-error-email");d.EMAIL_PATTERN.test(t)?(e.classList.remove("has-error"),n.classList.add("hide")):(e.classList.add("has-error"),e.value="",n.classList.remove("hide"))},validatePhone(e){const t=e.value,n=document.querySelector(".input-error-phone");d.PHONE_PATTERN.test(t)?(e.classList.remove("has-error"),n.classList.add("hide")):(e.classList.add("has-error"),e.value="",n.classList.remove("hide"))},validateAge(e){const t=e.value,n=document.querySelector(".input-error-age");t>0&&t<=123&&""!==t?(e.classList.remove("has-error"),n.classList.add("hide")):(e.classList.add("has-error"),e.value="",n.classList.remove("hide"))}};window.addEventListener("DOMContentLoaded",(()=>{console.log("HELLO"),"/main.html"===window.location.pathname?(function(){const e="http://localhost:2020/api/",t=document.querySelector("#firstnameInput"),d=document.querySelector("#lastnameInput"),i=document.querySelector("#cityInput"),u=document.querySelector("#phonenumberInput"),m=document.querySelector("#emailInput"),h=document.querySelector("#companynameInput"),p=document.querySelector("#ageInput"),y=document.querySelector("#dms"),g=document.querySelector(".table__dmsDropdown"),v=(document.querySelector("#msgStatus"),document.querySelector("#spinner")),E=document.querySelector("#status1"),f=document.querySelector("#status2"),L=document.querySelector("#status3"),S=document.querySelector("#status4"),I=document.querySelector("#create"),q=document.querySelector("#update"),b=document.querySelector("#clearAllPopupConfirm");let w="mysql",k=null;function _(){v.classList.remove("hideSpinner"),v.classList.add("showSpinner")}function C(){v.classList.remove("showSpinner"),v.classList.add("hideSpinner")}function N(e){switch(console.log(e),e){case"PostgreSQL":return"pg";case"MySQL":return"mysql";case"SQLite":return"sqlite";case"MongoDB":return"mongodb";case"Redis":return"redis";case"Cassandra":return"cassandra";case"Neo4j":return"neo4j"}}function P(){tbody.addEventListener("click",(e=>{let t=e.target.closest("tr");k=t.getAttribute("data-index")}))}function A(t){_(),o(e+t+"/persons/"+localStorage.getItem("id_user")).then((e=>e.json())).then((e=>{l(e)})).then((()=>{P(),c(),r(),C()})).catch((()=>{console.log("No")}))}function B(t){_(),o(e+t+"/persons/"+localStorage.getItem("id_user")).then((e=>e.json())).then((e=>{!function(e){const t=document.getElementById("searchFirstname"),n=document.getElementById("searchLastname");if(t.value||n.value||l(e),t.value&&!n.value){var a=[];e.forEach((e=>{e.fname.includes(t.value)&&a.push(e)})),l(a)}!t.value&&n.value&&(a=[],e.forEach((e=>{e.lname.includes(n.value)&&a.push(e)})),l(a)),t.value&&n.value&&(a=[],e.forEach((e=>{e.lname.includes(n.value)&&e.lname.includes(n.value)&&a.push(e)})),l(a))}(e),console.log("from searchBar")})).then((()=>{P(),c(),r(),C()})).catch((()=>{console.log("failed get request from db")}))}g.addEventListener("click",(e=>{e.preventDefault(),w=N(e.target.innerHTML),y.innerHTML=e.target.innerHTML,B(w)})),I.addEventListener("click",(function(){const a={fname:t.value,lname:d.value,age:+p.value,city:i.value,phoneNumber:u.value,email:m.value,companyName:h.value,user_id:+localStorage.getItem("id_user")};""===t.value||""===d.value||""===p.value||""===i.value||""===u.value||""===m.value||""===h.value?(S.classList.remove("hide"),setTimeout((()=>{S.classList.add("hide")}),2e3)):(_(),n(e+w+"/persons",a).then((()=>{C(),E.classList.remove("hide"),setTimeout((()=>{E.classList.add("hide")}),2e3),A(w)})))})),q.addEventListener("click",(function(){const e="http://localhost:2020/api/"+w+"/persons/",n={fname:t.value,lname:d.value,age:+p.value,city:i.value,phoneNumber:u.value,email:m.value,companyName:h.value,user_id:+localStorage.getItem("id_user")};_(),a(e+k,n).then((()=>{C(),f.classList.remove("hide"),A(w),setTimeout((()=>{f.classList.add("hide")}),2e3)}))})),document.getElementById("searchFirstname").addEventListener("change",(function(e){B(N(y.innerHTML))})),document.getElementById("searchLastname").addEventListener("change",(function(){B(N(y.innerHTML))})),b.addEventListener("click",(function(){s("http://localhost:2020/api/"+w+"/persons/all/"+localStorage.getItem("id_user")).then((()=>{A(w),status.innerHTML="deleted successfully",setTimeout((()=>{status.innerHTML=""}),2e3)}))})),tbody.addEventListener("click",(e=>{!function(e){const t="http://localhost:2020/api/"+w+"/persons/",n=e.target.getAttribute("data-index");null!==n&&s(t+n).then((()=>{A(w),L.classList.remove("hide"),setTimeout((()=>{L.classList.add("hide")}),2e3)}))}(e)})),A(w)}(),function(){const t=document.getElementById("settings"),n=document.getElementById("settingsPopup"),o=document.getElementById("settingsPopupCancel"),s=document.getElementById("closeSettingsPopUp"),r=document.getElementById("settings-icon"),c=document.querySelectorAll("[data-clear]"),l=document.querySelectorAll("[data-show]"),d=document.querySelectorAll(".eye"),i="hideSettingsPopup",u=document.getElementById("settingsPopupConfirm"),m=()=>{e.closePopup(n,i),e.clearInputs(c),e.resetPasswordType(l)};u.addEventListener("click",(()=>{!function(){const e=document.getElementById("newLogin"),t=document.getElementById("newPassword"),n=document.getElementById("repeatPassword"),o=document.querySelector(".settingsSuccess"),s=document.querySelector(".settingsError");var r=+localStorage.getItem("id_user");function c(e){e.classList.remove("hide")}function l(e){e.classList.add("hide")}t.value===n.value&&a("http://localhost:2020/api/mysql/users/"+r,{login:e.value,password:t.value}).then((e=>{201===e.status?(c(o),setTimeout((()=>{l(o)}),2e3)):(c(s),setTimeout((()=>{l(s)}),2e3))}))}(),m()})),t.addEventListener("mouseenter",(()=>{r.src="../img/shestir_yellow.png"})),t.addEventListener("mouseleave",(()=>{r.src="../img/shestir_white.png"})),t.addEventListener("click",(()=>{e.openPopup(n,i)})),o.addEventListener("click",(()=>{m()})),s.addEventListener("click",(()=>{m()})),window.addEventListener("keyup",(function(t){e.isEscapeKey(t)&&m()})),n.addEventListener("click",(function(e){e.target===n&&m()})),d.forEach((t=>{t.addEventListener("click",(()=>{e.changeType(l)}))}))}(),function(){const t=document.getElementById("clearAll"),n=document.getElementById("clearAllPopup"),a=document.getElementById("clearAllPopupCancel"),o=document.getElementById("closeClearAllPopUp"),s="hideClearAllPopup",r=document.querySelector("#clearAllPopupConfirm");t.addEventListener("click",(()=>{e.openPopup(n,s)})),r.addEventListener("click",(()=>{e.closePopup(n,s)})),a.addEventListener("click",(()=>{e.closePopup(n,s)})),o.addEventListener("click",(()=>{e.closePopup(n,s)})),window.addEventListener("keyup",(function(t){e.exitOnEscape(t,n,s)})),n.addEventListener("click",(function(t){e.handlePopupClick(t,n,s)}))}(),function(){const e=document.getElementById("logout"),t=document.getElementById("logout-icon");e.addEventListener("mouseenter",(()=>{t.src="../img/exit_yellow.png"})),e.addEventListener("mouseleave",(()=>{t.src="../img/exit_white.png"}))}(),function(){const e=document.getElementById("general"),t=document.getElementById("select-theme"),n=localStorage.getItem("selected-theme")||"dark";function a(e,t){switch(localStorage.setItem("selected-theme",t),t){case"dark":e.className="general theme-dark";break;case"light":e.className="general theme-light"}}t.value=n,a(e,n),t.addEventListener("change",(()=>{a(e,t.value)}))}(),function(){let e=document.getElementById("select-language");const t=document.querySelectorAll("[data-translate]"),n=document.querySelectorAll("[data-placeholder]"),a={firstName:"Імя",lastName:"Прізвище",age:"Вік",city:"Місто",phone:"Телефон",email:"Електронна пошта",company:"Компанія",create:"Створити",update:"Змінити",sort:"Сортувати",sortLabel:"Сортувати",clearAll:"Очистити всі",en:"Анг",ua:"Укр",light:"Світла",dark:"Темна",settings:"Налаштування",help:"Ви маєте можливість змінити логін та пароль",confirm:"Підтвердити",cancel:"Скасувати",delete:"Видалити",clarification:"Видалити всі елементи з таблиці?",newLogin:"Новий логін",yourPassword:"Попередній пароль",newPassword:"Новий пароль",repeatPassword:"Повторіть пароль",db:"База даних",success:"Дані успішно змінені",error:"Сталася помилка, спробуйте ще раз",cityError:"З великої літери та тільки літери, зайченятко",emailError:"Пам'ятай про равлика, сонечко",ageError:"Не вигадуй, дуже прошу.",deleteCP:"Дані успішно видалені, цьомки бомки",createCP:"Зірка народилась, кошенятко",updateCP:"Дані успішно змінені, насолоджуйся",noCP:"Введіть дані, я чекаю."},o={firstName:"First name",lastName:"Last name",age:"Age",city:"City",phone:"Phone number",email:"Email",company:"Company name",create:"Create",update:"Update",sort:"Sort",sortLabel:"Sort",clearAll:"Clear All",en:"En",ua:"Ua",light:"Light",dark:"Dark",settings:"Settings",help:"you can change your password and login",confirm:"CONFIRM",cancel:"CANCEL",delete:"DELETE",clarification:"Delete all elements from the table?",newLogin:"New login",yourPassword:"Your password",newPassword:"New password",repeatPassword:"Confirm password",db:"Data base",success:"Changed successfully",error:"Mistakes happens, try again",cityError:"Only capital letters",emailError:"your-email@domain.com",ageError:"Max age 123",deleteCP:"Successfully deleted",createCP:"Successfully created",updateCP:"Successfully updated",noCP:"Enter your data"},s=localStorage.getItem("selected-language")||"en";function r(e){let s=function(e){switch(e){case"ua":return a;case"en":default:return o}}(e);localStorage.setItem("selected-language",e),t.forEach((e=>{const t=e.dataset.translate;e.textContent=s[t]})),n.forEach((e=>{const t=e.dataset.placeholder;e.placeholder=s[t]}))}e.value=s,r(s),e.addEventListener("change",(t=>{r(e.value)}))}(),r(),document.querySelectorAll(".panel__input").forEach((e=>{e.addEventListener("change",(e=>{const t=e.target;switch(e.target.name){case"firstName":case"lastName":i.validateName(t);break;case"city":i.validateCity(t);break;case"email":i.validateEmail(t);break;case"phone":i.validatePhone(t);break;case"age":i.validateAge(t)}}))})),setInterval((function(){""===function(e){for(var t="token=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}()&&(document.location.href="/index.html")}),1e4),function(){const t=document.querySelectorAll(".panel__input"),n=document.querySelector(".input-error-phone"),a=document.querySelector(".input-error-email"),o=document.querySelector(".input-error-age"),s=document.querySelector(".input-error-city");document.getElementById("create");for(let r of t)window.addEventListener("keyup",(function(t){e.isEscapeKey(t)&&(r.value="",r.classList.remove("has-error"),t.target.blur(),n.classList.add("hide"),a.classList.add("hide"),o.classList.add("hide"),s.classList.add("hide"))}))}()):"/regpage.html"===window.location.pathname?function(){const e=document.querySelector("#reglogin"),t=document.querySelector("#regpass"),a=document.querySelector("#confirmregpass");document.querySelector(".reg__btn").addEventListener("click",(function(){var o,s;o=e.value,s=t.value,""===o&&""===s||o<5&&o>20&&s<5&&s>20||""===a.value?console.log("No reg"):t.value===a.value?n("http://localhost:2020/api/mysql/users",{login:e.value,password:t.value}).then((()=>{document.location.href="/index.html"})):a.style.backgroundColor="#fd9595"}))}():"/index.html"!==window.location.pathname&&"/"!==window.location.pathname||function(){const e=document.querySelector("#authlogin"),t=document.querySelector("#authpass");function a(){t.value="",t.style.backgroundColor="#fd9595",t.placeholder="Incorrect password"}document.querySelector(".auth__btn").addEventListener("click",(()=>{const o={login:e.value,password:t.value};o.login.length>=5&&o.password.length>=5?n("http://localhost:2020/api/mysql/auth",o).then((async e=>{if(console.log(e.status),e.ok){const t=await e.json();localStorage.setItem("id_user",t.id),document.cookie=`token=${t.token}; path=/; max-age=60*60*2`,document.location.href="/main.html"}else 400===e.status?a():document.location.href="/regpage.html"})):o.password.length<5&&a()}))}()}))})();
//# sourceMappingURL=bundle.js.map